<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Start a membership service with Firebase</title>

<script type="module">
import {
	initializeApp
} from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js"
const
app = initializeApp(
	{	apiKey				: "AIzaSyC9duBDgIRfIMe2ZSOW6_Y9njJ2_ciPex8"
	,	authDomain			: "techblog-e490f.firebaseapp.com"
	,	databaseURL			: "https://techblog-e490f-default-rtdb.firebaseio.com"
	,	projectId			: "techblog-e490f"
	,	storageBucket		: "techblog-e490f.appspot.com"
	,	messagingSenderId	: "433742686757"
	,	appId				: "1:433742686757:web:f3492d7e218274c08dedcc"
	,	measurementId		: "G-F92M3LRGRN"
	}
)

import {
	getAnalytics
} from "https://www.gstatic.com/firebasejs/10.10.0/firebase-analytics.js"
const
analytics = getAnalytics( app )

import {
	getStorage, ref, getDownloadURL
} from "https://www.gstatic.com/firebasejs/10.10.0/firebase-storage.js"
const
storage = getStorage( app )

const
SetImage = ( path, tag ) => getDownloadURL( ref( storage, path ) ).then(
	_ => document.getElementById( tag ).src = _
).catch(
	er => alert( er.message )
)
SetImage( 'HOME.png', 'IMG_HOME' )
SetImage( 'LOGIN_D.png', 'IMG_LOGIN_D' )
</script>

<style>
body {
;	max-width			: 640px
}
pre {
;	background-color	: black
;	padding				: 12px
;	overflow			: scroll
}
code {
;	color				: blue
}
pre > code {
;	color				: yellow
}
</style>
</head>

<body>



<h2>Start a membership online service with Firebase</h2>


<p>In recent years, the development of cloud services has created an environment where individuals can easily start their own membership-based online services.</p>

<p>In particular, using a Backend as a Service (BaaS) like Firebase allows developers to greatly simplify the complex process of building a backend. </p>

<p>Firebase provides many of the features needed to build an online service, such as authentication, database, file storage, and serverless functions, allowing developers to focus on the core functionality of their service.</p>

<p>Firebase also automatically scales with service growth, which can significantly reduce operational costs.</p>

<p>In this article, I will explain the specific steps for starting a membership-based online service as an individual using Firebase, while creating a fictitious service with slightly relaxed security as an example.</p>

<hr>

<h3>Fictitious Service Details</h3>

<img id="IMG_HOME" alt="Home image">

<p>This service is purely fictitious and will not be developed or released in reality.
Security must be carefully considered when developing this service.</p>

<h4>Concept:</h4>
<ul>
<li>Type: Investment information portal</li>
<li>Revenue model: Advertising revenue and newsletter subscriptions</li>
</ul>

<h4>Functional requirements:</h4>
<ul>
	<li>User registration and login</li>
	<li>Content management</li>
	<li>Payment processing</li>
	<li>External API integration:</li>
	<ul>
		<li>Various market data APIs</li>
		<li>Scraping</li>
	</ul>
	<li>Single-page application (SPA)</li>
</ul>

<h4>Security requirements:</h4>
<ul>
	<li>Only email addresses stored</li>
	<li>No personal information collected</li>
</ul>

<h4>Technical requirements:</h4>
<ul>
	<li>Frontend: Vanilla JS</li>
	<li>Backend: Firebase</li>
	<li>Database: Firebase Firestore</li>
	<li>Authentication: Firebase Authentication</li>
	<li>Payment processing: Stripe</li>
	<li>External APIs:</li>
	<ul>
		<li>Cryptocurrency exchanges</li>
		<li>Precios metals dealers</li>
	</ul>
</ul>

<hr>

<p>I hope this article will be helpful for those who want to start their own membership-based online service using Firebase!</p>
<p>The source code is available on <a href=https://github.com/Satachito/exp-fb>GitHub</a>. The dummy service is available at <a href=https://exp-fb-c223c.web.app/>https://exp-fb-c223c.web.app/</a>.
<p>Please feel free to ask any questions you may have.</p>



<h2>Firebase auth</h2>

<p>Firebase is a powerful platform that streamlines app development. However, it is currently in a state of flux, undergoing frequent version updates. The transition to v9, in particular, introduced a significant change with the introduction of the Modular API, which features a syntax that is vastly different from the traditional API.</p>

<h4>Migrating to the Modular API</h4>
<p>While the Modular API enables more flexible and efficient development, it breaks compatibility with legacy code. The Firebase team provides compat versions to maintain compatibility with past code, but the migration to the Modular API is recommended for the future.</p>

<h4>Firebase-UI and the Modular API</h4>
<p>Firebase includes Firebase-UI, an open-source UI library that simplifies the implementation of login functionality and more. However, Firebase-UI does not currently support the Modular API, and the migration process is expected to be time-consuming.</p>

<h4>Adapting to the Future</h4>
<p>Firebase will continue to evolve, and even more significant changes may be introduced in the future.</p>

<h4>Implementing a Robust Login Solution</h4>
<p>Considering this landscape, directly utilizing Firebase's features to implement login functionality emerges as the most viable option from a long-term perspective.</p>

<img id="IMG_LOGIN_D" alt="Login dialog image">

<p>By embracing the latest developments in Firebase and implementing login functionality directly, developers can ensure the longevity and adaptability of their applications.</p>

Let's take a look at the code, the HTML and CSS are shown on CodePen. Javascript follows separately because firebase does not work in CodePen.
A working version is available at <a src=https://techblog-e490f.web.app/Contents/FirebaseAuth.html>https://techblog-e490f.web.app/Contents/FirebaseAuth.html</a>

<p class="codepen" data-height="600" data-default-tab="html,result" data-slug-hash="RwOyxzr" data-user="satachito" style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/satachito/pen/RwOyxzr">
  Untitled</a> by Satachito (<a href="https://codepen.io/satachito">@satachito</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>


<pre><code>
import {
	initializeApp
} from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js"
const
app = initializeApp(
	//	Your setting here
)

import {
	getAnalytics
} from 'https://www.gstatic.com/firebasejs/10.10.0/firebase-analytics.js'
const
analytics = getAnalytics( app )

import {
	connectAuthEmulator
,	getAuth
,	onAuthStateChanged
,	signInWithEmailAndPassword
,	signInWithPopup
,	sendEmailVerification
,	createUserWithEmailAndPassword
,	GoogleAuthProvider
,	FacebookAuthProvider
,	GithubAuthProvider
,	signOut
} from 'https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js'
const
auth = getAuth( app )

location.hostname === 'localhost' && connectAuthEmulator( auth, 'http://localhost:9099' )

const
E = _ => document.getElementById( _ )

E( 'GOOGLE_LOGIN_B'		).onclick = () => signInWithPopup( auth, new GoogleAuthProvider		() ).catch( er => alert( er.message ) )
E( 'FACEBOOK_LOGIN_B'	).onclick = () => signInWithPopup( auth, new FacebookAuthProvider	() ).catch( er => alert( er.message ) )
E( 'GITHUB_LOGIN_B'		).onclick = () => signInWithPopup( auth, new GithubAuthProvider		() ).catch( er => alert( er.message ) )

E( 'EMAIL_LOGIN_B'		).onclick = () => signInWithEmailAndPassword		( auth, E( 'EMAIL_I' ).value, E( 'PASSWORD_I' ).value ).catch( er => alert( er.message ) )
E( 'REGISTER_EMAIL_B'	).onclick = () => createUserWithEmailAndPassword	( auth, E( 'EMAIL_I' ).value, E( 'PASSWORD_I' ).value ).catch( er => alert( er.message ) )

onAuthStateChanged(
	auth
,	user => (
		E( 'LOGIN_D' ).close()
	,	user
		?	(	user.emailVerified || (		//	see (A):
					sendEmailVerification( user ).then( () => alert( 'A confirmation email has been sent to the address provided. Kindly click the link within the email to confirm delivery.' ) )
				,	signOut( auth )
				)
			,	E( 'USER_B' ).textContent	= 'Sign out: ' + user.email
			,	E( 'USER_B' ).onclick		= () => signOut( auth ).then( () => alert( user.email + ': Signed out' ) )
			)
		:	(	E( 'USER_B' ).textContent	= 'Sign in/up'
			,	E( 'USER_B' ).onclick		= () => E( 'LOGIN_D' ).showModal()
			)
	)
)
</code></pre>

<p><b>(A):</b>If a user creates an account using <code>createUserWithEmailAndPassword</code>, <code>signInWithPopup</code> or <code>signInWithRedirect</code>, the user's email may not yet be verified.
(The email address is automatically verified only when using <code>GoogleAuthProvider</code>)</p>
<p>The user object in auth will not reflect that the email has been verified until the user logs in again, so <code>signOut</code> is one way to do it here.</p>




<h3>FYI: About Email Enumeration Protection in Firebase</h3>

<h4>Enhanced Security Against Credential Stuffing Attacks</h4>

<p>Since September 2023, Firebase has introduced the Email Enumeration Protection feature for its login functionality. This feature, also known as Email Address Enumeration Defense, neutralizes traditional attack methods and enhances user security.

<h4>What is Email Address Enumeration Attack?</h4>

<p>In traditional login systems, attackers attempt to log in to a target service with various email addresses and random passwords. If the error message "Email address is not registered" appears, the attacker can determine that the address is not registered. On the other hand, if the message "Incorrect password" is displayed, the attacker can confirm that the address is registered.</p>

<h4>How Email Enumeration Protection Works</h4>

<p>When the Email Enumeration Protection feature is enabled, all login attempts, regardless of the password, will result in the error message "Invalid credentials". This prevents attackers from determining whether an email address is registered, effectively thwarting email address enumeration attacks.</p>

<h4>Affected Methods</h4>

<p>The following methods are affected by enabling Email Enumeration Protection:

<ul>
	<li><code>signInWithEmailAndPassword</code></li>
	<li><code>fetchSignInMethodsForEmail</code></li>
	<li><code>sendPasswordResetEmail</code></li>
</ul>
<p>The <code>fetchSignInMethodsForEmail</code> function returns empty array.</p>
<p>The <code>sendPasswordResetEmail</code> is a function that sends a password reset email to a user. When this feature is enabled, no error will occur even for non-existent email addresses. This is because sending an email to a non-existent address is pointless, and the error message could reveal the existence of the address.</p>


<h4>Assumptions in this Article</h4>

<p>This article assumes that the Email Enumeration Protection feature is enabled.</p>
<p>However, the Firebase Auth Emulator does not have this feature, so you need to deploy and debug the authentication functionality thoroughly.</p>

</body>

</html>

